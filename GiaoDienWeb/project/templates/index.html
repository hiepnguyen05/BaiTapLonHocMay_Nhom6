<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ thống Phân loại Spam SMS - Socket.IO</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-shield-alt"></i> Hệ thống Phân loại Spam SMS</h1>
            <p>Hệ thống Phát hiện Spam SMS Đa ngôn ngữ Real-time với Socket.IO</p>
            <div class="connection-status" id="connectionStatus">
                <i class="fas fa-circle"></i> <span>Đang kết nối...</span>
            </div>
        </header>

        <div class="main-content">
            <!-- File Upload Section -->
            <section class="card">
                <h2><i class="fas fa-upload"></i> Tải lên Dữ liệu</h2>
                <div class="upload-area" id="uploadArea">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Kéo thả file CSV vào đây hoặc nhấn để chọn file</p>
                    <input type="file" id="fileInput" accept=".csv" hidden>
                    <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                        <i class="fas fa-file-csv"></i> Chọn File CSV
                    </button>
                </div>
                <div id="fileInfo" class="file-info hidden"></div>
            </section>

            <!-- Progress Section -->
            <section class="card">
                <h2><i class="fas fa-tasks"></i> Quy trình Xử lý Real-time</h2>
                <div class="progress-container">
                    <div class="progress-step" id="step1">
                        <div class="step-icon"><i class="fas fa-upload"></i></div>
                        <div class="step-content">
                            <h3>Tải lên Dữ liệu</h3>
                            <p>Tải lên và kiểm tra file CSV</p>
                        </div>
                        <div class="step-status"><i class="fas fa-clock"></i></div>
                    </div>
                    <div class="progress-step" id="step2">
                        <div class="step-icon"><i class="fas fa-broom"></i></div>
                        <div class="step-content">
                            <h3>Tiền xử lý Văn bản</h3>
                            <p>Làm sạch và tách từ dữ liệu văn bản</p>
                            <div class="progress-bar hidden" id="preprocessProgress">
                                <div class="progress-fill"></div>
                                <span class="progress-text">0%</span>
                            </div>
                        </div>
                        <div class="step-status"><i class="fas fa-clock"></i></div>
                    </div>
                    <div class="progress-step" id="step3">
                        <div class="step-icon"><i class="fas fa-vector-square"></i></div>
                        <div class="step-content">
                            <h3>Vector hóa</h3>
                            <p>BoW, TF-IDF, Sentence Embeddings</p>
                        </div>
                        <div class="step-status"><i class="fas fa-clock"></i></div>
                    </div>
                    <div class="progress-step" id="step4">
                        <div class="step-icon"><i class="fas fa-brain"></i></div>
                        <div class="step-content">
                            <h3>Huấn luyện Mô hình</h3>
                            <p>Huấn luyện bộ phân loại Naive Bayes</p>
                            <div class="training-progress hidden" id="trainingProgress"></div>
                        </div>
                        <div class="step-status"><i class="fas fa-clock"></i></div>
                    </div>
                </div>
                <button class="btn btn-success" id="processBtn" disabled>
                    <i class="fas fa-play"></i> Bắt đầu Xử lý
                </button>
            </section>

            <!-- Results Section -->
            <section class="card hidden" id="resultsSection">
                <h2><i class="fas fa-chart-bar"></i> Hiệu suất Mô hình</h2>
                <div class="results-grid" id="resultsGrid"></div>
                
                <!-- Summary Section -->
                <div class="summary-section hidden" id="summarySection">
                    <h3><i class="fas fa-trophy"></i> Tóm tắt Kết quả</h3>
                    <div class="summary-content" id="summaryContent"></div>
                </div>
                
                <div class="charts-container">
                    <!-- Model Comparison Chart -->
                    <div class="chart-item">
                        <h3><i class="fas fa-chart-line"></i> So sánh Hiệu suất Mô hình</h3>
                        <img id="comparisonChart" src="" alt="Biểu đồ So sánh" class="hidden">
                    </div>
                    
                    <!-- Feature Analysis Chart -->
                    <div class="chart-item">
                        <h3><i class="fas fa-search"></i> Phân tích Features Quan trọng - BoW</h3>
                        <img id="featureAnalysis" src="" alt="Phân tích Features" class="hidden">
                    </div>
                    
                    <!-- Individual Confusion Matrices -->
                    <div class="chart-item">
                        <h3><i class="fas fa-th"></i> Ma trận Nhầm lẫn</h3>
                        <img id="confusionMatrix" src="" alt="Ma trận Nhầm lẫn" class="hidden">
                    </div>
                </div>
                
            </section>

            <!-- Prediction Section -->
            <section class="card">
                <h2><i class="fas fa-search"></i> Kiểm tra Dự đoán Real-time</h2>
                <div class="prediction-container">
                    <div class="prediction-form">
                        <textarea id="testText" placeholder="Nhập tin nhắn SMS để phân loại (Tiếng Việt hoặc Tiếng Anh)..." rows="4"></textarea>
                        <div class="form-row">
                            <select id="methodSelect" disabled>
                                <option value="">Chọn phương pháp vector hóa</option>
                                <option value="bow">Bag of Words</option>
                                <option value="tfidf">TF-IDF</option>
                                <option value="sentence">Sentence Embeddings</option>
                            </select>
                            <button class="btn btn-primary" id="predictBtn" disabled>
                                <i class="fas fa-magic"></i> Dự đoán
                            </button>
                        </div>
                    </div>
                    <div class="prediction-result-container">
                        <div id="predictionResult" class="prediction-result hidden"></div>
                    </div>
                </div>
            </section>

            <!-- Test Files Generation Section -->
            <!-- Competition Files Section -->
            <section class="card hidden" id="competitionSection">
                <h2><i class="fas fa-trophy"></i> File Cuộc thi SMS Spam</h2>
                <div class="competition-info">
                    <div class="competition-description">
                        <h3><i class="fas fa-info-circle"></i> Thông tin Cuộc thi</h3>
                        <p><strong>Nhiệm vụ:</strong> Phân loại tin nhắn SMS thành spam (1) hoặc ham (0)</p>
                        <p><strong>Đánh giá:</strong> Accuracy giữa nhãn dự đoán và nhãn thực tế</p>
                        <div class="file-descriptions">
                            <div class="file-desc">
                                <h4><i class="fas fa-file-csv"></i> test.csv</h4>
                                <p>Tập kiểm tra chỉ có <code>id</code> và <code>sms</code> (không có nhãn)</p>
                            </div>
                            <div class="file-desc">
                                <h4><i class="fas fa-file-upload"></i> submission.csv</h4>
                                <p>File nộp bài với <code>id</code> và <code>label</code> (0 hoặc 1)</p>
                            </div>
                        </div>
                    </div>
                    <div class="competition-results" id="competitionResults">
                        <h3><i class="fas fa-trophy"></i> File Cuộc thi Đã tạo</h3>
                        <p>Sau khi hoàn thành training, các file sẽ được tạo tự động:</p>
                        <div class="competition-download-buttons">
                            <button class="btn btn-competition" id="downloadTestBtn" disabled>
                                <i class="fas fa-download"></i> Tải test.csv
                            </button>
                            <button class="btn btn-competition" id="downloadSubmissionBtn" disabled>
                                <i class="fas fa-download"></i> Tải submission.csv
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Real-time Logs -->
            <section class="card">
                <h2><i class="fas fa-terminal"></i> Nhật ký Real-time</h2>
                <div class="logs-container" id="logsContainer">
                    <div class="log-item">
                        <span class="log-time">[Khởi tạo]</span>
                        <span class="log-message">Hệ thống sẵn sàng...</span>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 Hệ thống Phân loại Spam SMS. Được xây dựng bằng Flask-SocketIO và Machine Learning.</p>
    </footer>

    <script src="/static/js/socket-app.js"></script>
</body>
</html>